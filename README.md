# GPT Bridge Project

Проект для автоматизации взаимодействия с ChatGPT через браузер с предоставлением API-интерфейса.

## Функционал

1. **Автоматическое открытие браузера** - открывает ChatGPT в браузере Chromium.
2. **Обработка всплывающих окон** - автоматически принимает cookies и другие поп-апы.
3. **API-интерфейс** - предоставляет REST API для отправки запросов к ChatGPT, включая OpenAI-совместимый эндпоинт.
4. **Автоматическое извлечение ответов** - находит и возвращает сгенерированные ответы.
5. **Автоматическая авторизация** - использует данные из .env для email и пароля, с возможностью ввода кода подтверждения через API.

## Установка и запуск

### Предварительные требования

- Python 3.10+ (рекомендуется 3.12 для лучшей производительности).
- Poetry (для управления зависимостями).

### Установка

```bash
# Клонирование репозитория
git clone https://github.com/your-username/GPTBridge_Project.git
cd GPTBridge_Project

# Установка зависимостей
poetry install

# Установка браузеров Playwright
poetry run playwright install
```

### Запуск

1. **Создайте файл .env с данными для авторизации:**

   ```bash
   # .env файл
   EMAIL_ADDRESS=your_email@example.com
   PASSWORD=your_password
   ```

2. **Запуск основного приложения:**

   ```bash
   # Запуск из корневой директории
   poetry run python outer/main.py
   ```

После запуска система:

- Откроет браузер с ChatGPT.
- Обработает всплывающие окна.
- Начнет автоматическую авторизацию с email и паролем из .env.
- Остановится на этапе ожидания кода подтверждения (если требуется).
- Запустит API-сервер на порту 8010.

## Процесс авторизации и тестирование

### Пошаговая инструкция по тестированию

1. **Запустите систему:**

   ```bash
   poetry run python outer/main.py
   ```

2. **Система автоматически начнет авторизацию и остановится на этапе ожидания кода (если он требуется).**

3. **Проверьте статус авторизации:**

   ```bash
   curl http://localhost:8010/auth/status
   ```

   **Ответ (ожидание кода):**

   ```json
   {
     "status": "waiting_code",
     "email_provided": true,
     "password_provided": true,
     "code_provided": false,
     "browser_initialized": true
   }
   ```

4. **Проверьте почту и найдите код подтверждения.**

5. **Отправьте код через API:**

   ```bash
   curl -X POST http://localhost:8010/auth/code \
     -H "Content-Type: application/json" \
     -d '{"code": "123456"}'
   ```

   **Ответ (успех):**

   ```json
   {
     "status": "success",
     "message": "Verification code provided successfully"
   }
   ```

6. **Проверьте, что авторизация завершена:**

   ```bash
   curl http://localhost:8010/auth/status
   ```

   **Ответ (авторизация завершена):**

   ```json
   {
     "status": "completed",
     "email_provided": true,
     "password_provided": true,
     "code_provided": true,
     "browser_initialized": true
   }
   ```

7. **Теперь можно отправлять запросы к ChatGPT.**

## Использование API

### Отправка простого запроса к ChatGPT

**Endpoint:** `POST /ask`

**Параметры:**

```json
{
  "prompt": "Ваш запрос к ChatGPT"
}
```

**Пример использования:**

```bash
curl -X POST http://localhost:8010/ask \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Hello, how are you?"}'
```

**Ответ:**

```json
{
  "answer": "Hey there! I'm doing well, thanks for asking. How about you?"
}
```

### OpenAI-совместимый эндпоинт

**Endpoint:** `POST /v1/chat/completions`

Поддерживает формат запросов OpenAI API. Извлекает system-промпт и последний user-message, игнорируя остальные поля для совместимости.

**Параметры (пример):**

```json
{
  "model": "gpt-4-turbo",
  "messages": [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "Hello, how are you?"}
  ],
  "temperature": 0.7
}
```

**Пример использования:**

```bash
curl -X POST http://localhost:8010/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4-turbo",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "Hello, how are you?"}
    ]
  }'
```

**Ответ (в формате OpenAI):**

```json
{
  "id": "chatcmpl-abc123",
  "object": "chat.completion",
  "created": 1739930000,
  "model": "gpt-4-turbo",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "Hey there! I'm doing well, thanks for asking. How about you?"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 12,
    "total_tokens": 22
  }
}
```

### Проверка состояния сервера

**Endpoint:** `GET /health`

```bash
curl http://localhost:8010/health
```

**Ответ:**

```json
{
  "status": "healthy",
  "service": "GPT Bridge API",
  "queue_size": 0,
  "processing": false
}
```

### Другие API-эндпоинты

- **Проверка статуса авторизации:** `GET /auth/status`
- **Ввод кода подтверждения:** `POST /auth/code` (если требуется).

## Структура проекта

```schema
GPTBridge_Project/
├── outer/                  # Основная рабочая версия
│   ├── main.py            # Точка входа
│   ├── client/
│   │   └── browser_client.py # Клиент для работы с браузером
│   ├── server/
│   │   └── api_server.py  # API-сервер
│   └── services/
│       ├── chatgpt_bridge.py # Основной сервис
│       └── request_queue.py  # Очередь запросов
├── pyproject.toml         # Конфигурация Poetry
└── README.md              # Документация
```

## Технические детали

### Используемые технологии

- **Playwright** - для автоматизации браузера.
- **FastAPI** - для создания API.
- **Uvicorn** - ASGI-сервер.
- **Poetry** - управление зависимостями.

### Особенности реализации

1. **Обход обнаружения автоматизации** - используются кастомные настройки браузера.
2. **Множественные селекторы** - для надежного поиска элементов интерфейса.
3. **Асинхронная архитектура** - для эффективной работы с браузером и API.
4. **Обработка ошибок** - корректная обработка таймаутов и исключений.
5. **Очередь запросов** - обеспечивает последовательную обработку промптов.

## Возможные проблемы и решения

### Браузер не запускается

- Убедитесь, что установлены все зависимости: `poetry install`.
- Проверьте установку браузеров: `poetry run playwright install`.

### Не находится поле ввода

- Проект использует множественные селекторы для надежности.
- При изменении интерфейса ChatGPT может потребоваться обновление селекторов в `browser_client.py`.

### Таймауты при ожидании ответа

- Увеличьте `max_wait_time` в `_wait_for_response_complete` в `browser_client.py`.
- При медленном интернете может потребоваться большее время ожидания.

## Лицензия

MIT License

Copyright (c) 2025 GPT Bridge Project

Разрешение предоставляется бесплатно любому лицу, получившему копию этого программного обеспечения и сопутствующей документации (далее "Программное обеспечение"), для использования Программного обеспечения без ограничений, включая, без ограничений, права на использование, копирование, изменение, объединение, публикацию, распространение, сублицензирование и/или продажу копий Программного обеспечения, а также лицам, которым предоставляется данное Программное обеспечение, при соблюдении следующих условий:

Указанное выше уведомление об авторских правах и данные условия должны быть включены во все копии или значимые части Программного обеспечения.

ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ ПРЕДОСТАВЛЯЕТСЯ «КАК ЕСТЬ», БЕЗ КАКИХ-ЛИБО ГАРАНТИЙ, ЯВНО ВЫРАЖЕННЫХ ИЛИ ПОДРАЗУМЕВАЕМЫХ, ВКЛЮЧАЯ, НО НЕ ОГРАНИЧИВАЯСЬ ГАРАНТИЯМИ ТОВАРНОЙ ПРИГОДНОСТИ, СООТВЕТСТВИЯ ПО ЕГО КОНКРЕТНОМУ НАЗНАЧЕНИЮ И НЕНАРУШЕНИЯ ПРАВ. НИ В КАКОМ СЛУЧАЕ АВТОРЫ ИЛИ ПРАВООБЛАДАТЕЛИ НЕ НЕСУТ ОТВЕТСТВЕННОСТИ ПО КАКИМ-ЛИБО ИСКАМ, ЗА УЩЕРБ ИЛИ ПО ИНЫМ ТРЕБОВАНИЯМ, В ТОМ ЧИСЛЕ, ПРИ ДЕЙСТВИИ КОНТРАКТА, ДЕЛИКТЕ ИЛИ ИНОЙ СИТУАЦИИ, ВОЗНИКШИМ ИЗ-ЗА ИСПОЛЬЗОВАНИЯ ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ ИЛИ ИНЫМ ДЕЙСТВИЙ С ПРОГРАММНЫМ ОБЕСПЕЧЕНИЕМ.
